!function(i,e){function t(t){this.wrap=t,this.dataList=[],this.indexObj=null,this.timer=null,this.curIndex=0,this.list=null,this.progress=e.progress.pro()}t.prototype={init(){this.getDom(),this.getData("../mock/data.json")},getDom(){this.record=document.querySelector(".songImg img"),this.controlBtns=document.querySelectorAll(".control li")},getData(t){var s=this;i.ajax({url:t,method:"get",success:function(t){s.dataList=t,s.listPlay(),s.indexObj=new e.controlIndex(t.length),s.loadMusic(s.indexObj.index),s.musicControl(),s.dragProgress()},error:function(){}})},loadMusic(t){e.render(this.dataList[t]),e.music.load(this.dataList[t].audioSrc),this.progress.renderAllTime(this.dataList[t].duration),"play"===e.music.status&&(e.music.play(),this.controlBtns[2].className="playing",this.imgRotate(0),this.progress.move(0)),this.list.changeSelect(t),this.curIndex=t,e.music.end(()=>{this.loadMusic(this.indexObj.next())})},musicControl(){this.controlBtns[1].addEventListener("touchend",()=>{e.music.status="play",this.loadMusic(this.indexObj.prev())}),this.controlBtns[2].addEventListener("touchend",()=>{var t;"play"===e.music.status?(e.music.pause(),this.controlBtns[2].className="",this.imgStop()):(e.music.play(),this.controlBtns[2].className="playing",t=this.record.dataset.rotate||0,this.imgRotate(t),this.progress.move())}),this.controlBtns[3].addEventListener("touchend",()=>{e.music.status="play",this.loadMusic(this.indexObj.next())})},imgRotate(t){clearInterval(this.timer),this.timer=setInterval(()=>{t=+t+.2,this.record.style.transform=`rotate(${t}deg)`,this.record.dataset.rotate=t},1e3/60)},imgStop(){clearInterval(this.timer)},listPlay(){this.list=e.listControl(this.dataList,this.wrap),this.controlBtns[4].addEventListener("touchend",()=>{this.list.slideUp()}),this.list.musicList.forEach((t,s)=>{t.addEventListener("touchend",()=>{this.curIndex!==s&&(e.music.status="play",this.indexObj.index=s,this.loadMusic(s),this.list.slideDown())})})},dragProgress(){var i=this;const t=e.progress.drag(document.querySelector(".circle"));t.init(),t.start=function(){i.progress.stop()},t.move=function(t){i.progress.update(t)},t.end=function(t){var s=t*i.dataList[i.indexObj.index].duration;e.music.playTo(s),e.music.play(),i.progress.move(t);t=i.record.dataset.rotate||0;i.imgRotate(t),i.controlBtns[2].className="playing"}}};const s=new t(document.getElementById("wrap"));s.init()}(window.Zepto,window.player);